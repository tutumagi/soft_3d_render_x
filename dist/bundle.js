(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
}); /// <reference path="babylon.math.ts"/>

var main_1 = require("./main");

var canvas;
var device;
var mesh;
var meshes = [];
var camera;
document.addEventListener("DOMContentLoaded", init, false);

function init() {
  canvas = document.getElementById("frontBuffer");
  mesh = new main_1.SoftEngine.Mesh("Cube", 8);
  meshes.push(mesh);
  camera = new main_1.SoftEngine.Camera();
  device = new main_1.SoftEngine.Device(canvas);
  mesh.vertices[0] = new BABYLON.Vector3(-1, 1, 1);
  mesh.vertices[1] = new BABYLON.Vector3(1, 1, 1);
  mesh.vertices[2] = new BABYLON.Vector3(-1, -1, 1);
  mesh.vertices[3] = new BABYLON.Vector3(-1, -1, -1);
  mesh.vertices[4] = new BABYLON.Vector3(-1, 1, -1);
  mesh.vertices[5] = new BABYLON.Vector3(1, 1, -1);
  mesh.vertices[6] = new BABYLON.Vector3(1, -1, 1);
  mesh.vertices[7] = new BABYLON.Vector3(1, -1, -1);
  camera.position = new BABYLON.Vector3(0, 0, 10);
  camera.target = new BABYLON.Vector3(0, 0, 0); // Calling the HTML5 rendering loop

  requestAnimationFrame(drawingLoop);
}

function drawingLoop() {
  device.clear(); // rotating slightly the cube during each frame rendered

  mesh.rotation.x += 0.01;
  mesh.rotation.y += 0.01; // Doing the various matrix operations

  device.render(camera, meshes); // Flushing the back buffer into the front buffer

  device.present(); // Calling the HTML5 rendering loop recursively

  requestAnimationFrame(drawingLoop);
}

},{"./main":2}],2:[function(require,module,exports){
"use strict"; /// <reference path="babylon.math.ts"/>

Object.defineProperty(exports, "__esModule", {
  value: true
});
var SoftEngine;

(function (SoftEngine) {
  var Camera =
  /** @class */
  function () {
    function Camera() {
      this.position = BABYLON.Vector3.Zero();
      this.target = BABYLON.Vector3.Zero();
    }

    return Camera;
  }();

  SoftEngine.Camera = Camera;

  var Mesh =
  /** @class */
  function () {
    function Mesh(name, verticesCount) {
      this.name = name;
      this.vertices = new Array(verticesCount);
      this.rotation = BABYLON.Vector3.Zero();
      this.postion = BABYLON.Vector3.Zero();
    }

    return Mesh;
  }();

  SoftEngine.Mesh = Mesh;

  var Device =
  /** @class */
  function () {
    function Device(canvas) {
      this.workingCanvas = canvas;
      this.workingWidth = canvas.width;
      this.workingHeight = canvas.height;
      this.workingContext = this.workingCanvas.getContext("2d");
    }

    Device.prototype.clear = function () {
      this.workingContext.clearRect(0, 0, this.workingWidth, this.workingHeight);
      this.backbuffer = this.workingContext.getImageData(0, 0, this.workingWidth, this.workingHeight);
    };

    Device.prototype.present = function () {
      this.workingContext.putImageData(this.backbuffer, 0, 0);
    };

    Device.prototype.putPixel = function (x, y, color) {
      this.backbufferdata = this.backbuffer.data;
      var index = ((x >> 0) + (y >> 0) * this.workingWidth) * 4;
      this.backbufferdata[index] = color.r * 255;
      this.backbufferdata[index + 1] = color.g * 255;
      this.backbufferdata[index + 2] = color.b * 255;
      this.backbufferdata[index + 3] = color.a * 255;
    };

    Device.prototype.project = function (coord, transMat) {
      var point = BABYLON.Vector3.TransformCoordinates(coord, transMat);
      var x = point.x * this.workingWidth + this.workingWidth / 2.0 >> 0;
      var y = -point.y * this.workingHeight + this.workingHeight / 2.0 >> 0;
      return new BABYLON.Vector2(x, y);
    };

    Device.prototype.drawPoint = function (point) {
      if (point.x >= 0 && point.y >= 0 && point.x < this.workingWidth && point.y < this.workingHeight) {
        this.putPixel(point.x, point.y, new BABYLON.Color4(1, 1, 0, 1));
      }
    };

    Device.prototype.render = function (camera, meshes) {
      var viewMatrix = BABYLON.Matrix.LookAtLH(camera.position, camera.target, BABYLON.Vector3.Up());
      var projectMatrix = BABYLON.Matrix.PerspectiveFovLH(0.78, this.workingWidth / this.workingHeight, 0.01, 1.0);

      for (var _i = 0, meshes_1 = meshes; _i < meshes_1.length; _i++) {
        var cMesh = meshes_1[_i];
        var worldMatrix = BABYLON.Matrix.RotationYawPitchRoll(cMesh.rotation.y, cMesh.rotation.x, cMesh.rotation.z).multiply(BABYLON.Matrix.Translation(cMesh.postion.x, cMesh.postion.y, cMesh.postion.z));
        var transformMatrix = worldMatrix.multiply(viewMatrix).multiply(projectMatrix);

        for (var _a = 0, _b = cMesh.vertices; _a < _b.length; _a++) {
          var indexVertex = _b[_a];
          var projectPoint = this.project(indexVertex, transformMatrix);
          this.drawPoint(projectPoint);
        }
      }
    };

    return Device;
  }();

  SoftEngine.Device = Device;
})(SoftEngine = exports.SoftEngine || (exports.SoftEngine = {}));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLnRzIiwic3JjL21haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0lDQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQTs7QUFFQSxJQUFJLE1BQUo7QUFDQSxJQUFJLE1BQUo7QUFDQSxJQUFJLElBQUo7QUFDQSxJQUFNLE1BQU0sR0FBc0IsRUFBbEM7QUFDQSxJQUFJLE1BQUo7QUFFQSxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLElBQTlDLEVBQW9ELEtBQXBEOztBQUVBLFNBQVMsSUFBVCxHQUFhO0FBQ1QsRUFBQSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsYUFBeEIsQ0FBVDtBQUNBLEVBQUEsSUFBSSxHQUFHLElBQUksTUFBQSxDQUFBLFVBQUEsQ0FBVyxJQUFmLENBQW9CLE1BQXBCLEVBQTRCLENBQTVCLENBQVA7QUFFQSxFQUFBLE1BQU0sQ0FBQyxJQUFQLENBQVksSUFBWjtBQUNBLEVBQUEsTUFBTSxHQUFHLElBQUksTUFBQSxDQUFBLFVBQUEsQ0FBVyxNQUFmLEVBQVQ7QUFDQSxFQUFBLE1BQU0sR0FBRyxJQUFJLE1BQUEsQ0FBQSxVQUFBLENBQVcsTUFBZixDQUFzQixNQUF0QixDQUFUO0FBRUEsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFDLENBQXJCLEVBQXdCLENBQXhCLEVBQTJCLENBQTNCLENBQW5CO0FBQ0EsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFwQixFQUF1QixDQUF2QixFQUEwQixDQUExQixDQUFuQjtBQUNBLEVBQUEsSUFBSSxDQUFDLFFBQUwsQ0FBYyxDQUFkLElBQW1CLElBQUksT0FBTyxDQUFDLE9BQVosQ0FB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RUFBQSxFQUFBLEdBQUEsS0FBSyxDQUFDLFFBQWhDLEVBQTBCLEVBQUEsR0FBQSxFQUFBLENBQUEsTUFBMUIsRUFBMEIsRUFBQSxFQUExQixFQUEwQztBQUFyQyxjQUFNLFdBQVcsR0FBQSxFQUFBLENBQUEsRUFBQSxDQUFqQjtBQUNELGNBQU0sWUFBWSxHQUFHLEtBQUssT0FBTCxDQUFhLFdBQWIsRUFBMEIsZUFBMUIsQ0FBckI7QUFDQSxlQUFLLFNBQUwsQ0FBZSxZQUFmO0FBQ0g7QUFDSjtBQUNKLEtBeEJNOztBQXlCWCxXQUFBLE1BQUE7QUFBQyxHQTdFRCxFQUFBOztBQUFhLEVBQUEsVUFBQSxDQUFBLE1BQUEsR0FBTSxNQUFOO0FBOEVoQixDQXJHRCxFQUFpQixVQUFVLEdBQVYsT0FBQSxDQUFBLFVBQUEsS0FBQSxPQUFBLENBQUEsVUFBQSxHQUFVLEVBQVYsQ0FBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiYmFieWxvbi5tYXRoLnRzXCIvPlxuaW1wb3J0IHsgU29mdEVuZ2luZSB9IGZyb20gXCIuL21haW5cIjtcblxubGV0IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG5sZXQgZGV2aWNlOiBTb2Z0RW5naW5lLkRldmljZTtcbmxldCBtZXNoOiBTb2Z0RW5naW5lLk1lc2g7XG5jb25zdCBtZXNoZXM6IFNvZnRFbmdpbmUuTWVzaFtdID0gW107XG5sZXQgY2FtZXJhOiBTb2Z0RW5naW5lLkNhbWVyYTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgaW5pdCwgZmFsc2UpO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZnJvbnRCdWZmZXJcIikgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgbWVzaCA9IG5ldyBTb2Z0RW5naW5lLk1lc2goXCJDdWJlXCIsIDgpO1xuXG4gICAgbWVzaGVzLnB1c2gobWVzaCk7XG4gICAgY2FtZXJhID0gbmV3IFNvZnRFbmdpbmUuQ2FtZXJhKCk7XG4gICAgZGV2aWNlID0gbmV3IFNvZnRFbmdpbmUuRGV2aWNlKGNhbnZhcyk7XG5cbiAgICBtZXNoLnZlcnRpY2VzWzBdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgMSwgMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1sxXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgMSwgMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1syXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTEsIC0xLCAxKTtcbiAgICBtZXNoLnZlcnRpY2VzWzNdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgLTEsIC0xKTtcbiAgICBtZXNoLnZlcnRpY2VzWzRdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgMSwgLTEpO1xuICAgIG1lc2gudmVydGljZXNbNV0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDEsIDEsIC0xKTtcbiAgICBtZXNoLnZlcnRpY2VzWzZdID0gbmV3IEJBQllMT04uVmVjdG9yMygxLCAtMSwgMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1s3XSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgLTEsIC0xKTtcblxuICAgIGNhbWVyYS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMCwgMTApO1xuICAgIGNhbWVyYS50YXJnZXQgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDAsIDApO1xuXG4gICAgLy8gQ2FsbGluZyB0aGUgSFRNTDUgcmVuZGVyaW5nIGxvb3BcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd2luZ0xvb3ApO1xufVxuXG5mdW5jdGlvbiBkcmF3aW5nTG9vcCgpIHtcbiAgICBkZXZpY2UuY2xlYXIoKTtcblxuICAgIC8vIHJvdGF0aW5nIHNsaWdodGx5IHRoZSBjdWJlIGR1cmluZyBlYWNoIGZyYW1lIHJlbmRlcmVkXG4gICAgbWVzaC5yb3RhdGlvbi54ICs9IDAuMDE7XG4gICAgbWVzaC5yb3RhdGlvbi55ICs9IDAuMDE7XG5cbiAgICAvLyBEb2luZyB0aGUgdmFyaW91cyBtYXRyaXggb3BlcmF0aW9uc1xuICAgIGRldmljZS5yZW5kZXIoY2FtZXJhLCBtZXNoZXMpO1xuICAgIC8vIEZsdXNoaW5nIHRoZSBiYWNrIGJ1ZmZlciBpbnRvIHRoZSBmcm9udCBidWZmZXJcbiAgICBkZXZpY2UucHJlc2VudCgpO1xuXG4gICAgLy8gQ2FsbGluZyB0aGUgSFRNTDUgcmVuZGVyaW5nIGxvb3AgcmVjdXJzaXZlbHlcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd2luZ0xvb3ApO1xufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImJhYnlsb24ubWF0aC50c1wiLz5cblxuZXhwb3J0IG5hbWVzcGFjZSBTb2Z0RW5naW5lIHtcbiAgICBleHBvcnQgY2xhc3MgQ2FtZXJhIHtcbiAgICAgICAgcHVibGljIHBvc2l0aW9uOiBCQUJZTE9OLlZlY3RvcjM7XG4gICAgICAgIHB1YmxpYyB0YXJnZXQ6IEJBQllMT04uVmVjdG9yMztcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBCQUJZTE9OLlZlY3RvcjMuWmVybygpO1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBCQUJZTE9OLlZlY3RvcjMuWmVybygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGNsYXNzIE1lc2gge1xuICAgICAgICBwdWJsaWMgcG9zdGlvbjogQkFCWUxPTi5WZWN0b3IzO1xuICAgICAgICBwdWJsaWMgcm90YXRpb246IEJBQllMT04uVmVjdG9yMztcbiAgICAgICAgcHVibGljIHZlcnRpY2VzOiBCQUJZTE9OLlZlY3RvcjNbXTtcblxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCB2ZXJ0aWNlc0NvdW50OiBudW1iZXIpIHtcbiAgICAgICAgICAgIHRoaXMudmVydGljZXMgPSBuZXcgQXJyYXkodmVydGljZXNDb3VudCk7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gQkFCWUxPTi5WZWN0b3IzLlplcm8oKTtcbiAgICAgICAgICAgIHRoaXMucG9zdGlvbiA9IEJBQllMT04uVmVjdG9yMy5aZXJvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHBvcnQgY2xhc3MgRGV2aWNlIHtcbiAgICAgICAgcHJpdmF0ZSBiYWNrYnVmZmVyPzogSW1hZ2VEYXRhO1xuICAgICAgICBwcml2YXRlIHdvcmtpbmdDYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgICAgICBwcml2YXRlIHdvcmtpbmdDb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gICAgICAgIHByaXZhdGUgd29ya2luZ1dpZHRoOiBudW1iZXI7XG4gICAgICAgIHByaXZhdGUgd29ya2luZ0hlaWdodDogbnVtYmVyO1xuXG4gICAgICAgIHByaXZhdGUgYmFja2J1ZmZlcmRhdGE/OiBVaW50OENsYW1wZWRBcnJheTtcblxuICAgICAgICBjb25zdHJ1Y3RvcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLndvcmtpbmdDYW52YXMgPSBjYW52YXM7XG4gICAgICAgICAgICB0aGlzLndvcmtpbmdXaWR0aCA9IGNhbnZhcy53aWR0aDtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0hlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG5cbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQgPSB0aGlzLndvcmtpbmdDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpITtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBjbGVhcigpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMud29ya2luZ1dpZHRoLCB0aGlzLndvcmtpbmdIZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5iYWNrYnVmZmVyID0gdGhpcy53b3JraW5nQ29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy53b3JraW5nV2lkdGgsIHRoaXMud29ya2luZ0hlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgcHJlc2VudCgpIHtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQucHV0SW1hZ2VEYXRhKHRoaXMuYmFja2J1ZmZlciEsIDAsIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHB1dFBpeGVsKHg6IG51bWJlciwgeTogbnVtYmVyLCBjb2xvcjogQkFCWUxPTi5Db2xvcjQpIHtcbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGEgPSB0aGlzLmJhY2tidWZmZXIhLmRhdGE7XG5cbiAgICAgICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSAoKHggPj4gMCkgKyAoeSA+PiAwKSAqIHRoaXMud29ya2luZ1dpZHRoKSAqIDQ7XG5cbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGFbaW5kZXhdID0gY29sb3IuciAqIDI1NTtcbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGFbaW5kZXggKyAxXSA9IGNvbG9yLmcgKiAyNTU7XG4gICAgICAgICAgICB0aGlzLmJhY2tidWZmZXJkYXRhW2luZGV4ICsgMl0gPSBjb2xvci5iICogMjU1O1xuICAgICAgICAgICAgdGhpcy5iYWNrYnVmZmVyZGF0YVtpbmRleCArIDNdID0gY29sb3IuYSAqIDI1NTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBwcm9qZWN0KGNvb3JkOiBCQUJZTE9OLlZlY3RvcjMsIHRyYW5zTWF0OiBCQUJZTE9OLk1hdHJpeCk6IEJBQllMT04uVmVjdG9yMiB7XG4gICAgICAgICAgICBjb25zdCBwb2ludCA9IEJBQllMT04uVmVjdG9yMy5UcmFuc2Zvcm1Db29yZGluYXRlcyhjb29yZCwgdHJhbnNNYXQpO1xuXG4gICAgICAgICAgICBjb25zdCB4ID0gKHBvaW50LnggKiB0aGlzLndvcmtpbmdXaWR0aCArIHRoaXMud29ya2luZ1dpZHRoIC8gMi4wKSA+PiAwO1xuICAgICAgICAgICAgY29uc3QgeSA9ICgtcG9pbnQueSAqIHRoaXMud29ya2luZ0hlaWdodCArIHRoaXMud29ya2luZ0hlaWdodCAvIDIuMCkgPj4gMDtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBCQUJZTE9OLlZlY3RvcjIoeCwgeSk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgZHJhd1BvaW50KHBvaW50OiBCQUJZTE9OLlZlY3RvcjIpIHtcbiAgICAgICAgICAgIGlmIChwb2ludC54ID49IDAgJiYgcG9pbnQueSA+PSAwICYmIHBvaW50LnggPCB0aGlzLndvcmtpbmdXaWR0aCAmJiBwb2ludC55IDwgdGhpcy53b3JraW5nSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXRQaXhlbChwb2ludC54LCBwb2ludC55LCBuZXcgQkFCWUxPTi5Db2xvcjQoMSwgMSwgMCwgMSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHJlbmRlcihjYW1lcmE6IENhbWVyYSwgbWVzaGVzOiBNZXNoW10pIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdNYXRyaXggPSBCQUJZTE9OLk1hdHJpeC5Mb29rQXRMSChjYW1lcmEucG9zaXRpb24sIGNhbWVyYS50YXJnZXQsIEJBQllMT04uVmVjdG9yMy5VcCgpKTtcblxuICAgICAgICAgICAgY29uc3QgcHJvamVjdE1hdHJpeCA9IEJBQllMT04uTWF0cml4LlBlcnNwZWN0aXZlRm92TEgoXG4gICAgICAgICAgICAgICAgMC43OCxcbiAgICAgICAgICAgICAgICB0aGlzLndvcmtpbmdXaWR0aCAvIHRoaXMud29ya2luZ0hlaWdodCxcbiAgICAgICAgICAgICAgICAwLjAxLFxuICAgICAgICAgICAgICAgIDEuMCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgY01lc2ggb2YgbWVzaGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd29ybGRNYXRyaXggPSBCQUJZTE9OLk1hdHJpeC5Sb3RhdGlvbllhd1BpdGNoUm9sbChcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueSxcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueCxcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueixcbiAgICAgICAgICAgICAgICApLm11bHRpcGx5KEJBQllMT04uTWF0cml4LlRyYW5zbGF0aW9uKGNNZXNoLnBvc3Rpb24ueCwgY01lc2gucG9zdGlvbi55LCBjTWVzaC5wb3N0aW9uLnopKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybU1hdHJpeCA9IHdvcmxkTWF0cml4Lm11bHRpcGx5KHZpZXdNYXRyaXgpLm11bHRpcGx5KHByb2plY3RNYXRyaXgpO1xuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbmRleFZlcnRleCBvZiBjTWVzaC52ZXJ0aWNlcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0UG9pbnQgPSB0aGlzLnByb2plY3QoaW5kZXhWZXJ0ZXgsIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd1BvaW50KHByb2plY3RQb2ludCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufVxuIl19
