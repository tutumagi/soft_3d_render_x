(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
}); /// <reference path="babylon.math.ts"/>

var main_1 = require("./main");

var canvas;
var device;
var mesh;
var meshes = [];
var camera;
document.addEventListener("DOMContentLoaded", init, false);

function init() {
  canvas = document.getElementById("frontBuffer"); // mesh = new SoftEngine.Mesh("Cube", 8);
  // meshes.push(mesh);
  // mesh.vertices[0] = new BABYLON.Vector3(-1, 1, 1);
  // mesh.vertices[1] = new BABYLON.Vector3(1, 1, 1);
  // mesh.vertices[2] = new BABYLON.Vector3(-1, -1, 1);
  // mesh.vertices[3] = new BABYLON.Vector3(-1, -1, -1);
  // mesh.vertices[4] = new BABYLON.Vector3(-1, 1, -1);
  // mesh.vertices[5] = new BABYLON.Vector3(1, 1, -1);
  // mesh.vertices[6] = new BABYLON.Vector3(1, -1, 1);
  // mesh.vertices[7] = new BABYLON.Vector3(1, -1, -1);

  mesh = new main_1.SoftEngine.Mesh("Cube", 8, 12);
  meshes.push(mesh);
  mesh.vertices[0] = new BABYLON.Vector3(-1, 1, 1);
  mesh.vertices[1] = new BABYLON.Vector3(1, 1, 1);
  mesh.vertices[2] = new BABYLON.Vector3(-1, -1, 1);
  mesh.vertices[3] = new BABYLON.Vector3(1, -1, 1);
  mesh.vertices[4] = new BABYLON.Vector3(-1, 1, -1);
  mesh.vertices[5] = new BABYLON.Vector3(1, 1, -1);
  mesh.vertices[6] = new BABYLON.Vector3(1, -1, -1);
  mesh.vertices[7] = new BABYLON.Vector3(-1, -1, -1);
  mesh.faces[0] = {
    A: 0,
    B: 1,
    C: 2
  };
  mesh.faces[1] = {
    A: 1,
    B: 2,
    C: 3
  };
  mesh.faces[2] = {
    A: 1,
    B: 3,
    C: 6
  };
  mesh.faces[3] = {
    A: 1,
    B: 5,
    C: 6
  };
  mesh.faces[4] = {
    A: 0,
    B: 1,
    C: 4
  };
  mesh.faces[5] = {
    A: 1,
    B: 4,
    C: 5
  };
  mesh.faces[6] = {
    A: 2,
    B: 3,
    C: 7
  };
  mesh.faces[7] = {
    A: 3,
    B: 6,
    C: 7
  };
  mesh.faces[8] = {
    A: 0,
    B: 2,
    C: 7
  };
  mesh.faces[9] = {
    A: 0,
    B: 4,
    C: 7
  };
  mesh.faces[10] = {
    A: 4,
    B: 5,
    C: 6
  };
  mesh.faces[11] = {
    A: 4,
    B: 6,
    C: 7
  };
  camera = new main_1.SoftEngine.Camera();
  device = new main_1.SoftEngine.Device(canvas);
  camera.position = new BABYLON.Vector3(0, 0, 10);
  camera.target = new BABYLON.Vector3(0, 0, 0); // Calling the HTML5 rendering loop

  requestAnimationFrame(drawingLoop);
}

function drawingLoop() {
  device.clear(); // rotating slightly the cube during each frame rendered

  mesh.rotation.x += 0.01;
  mesh.rotation.y += 0.01; // Doing the various matrix operations

  device.render(camera, meshes); // Flushing the back buffer into the front buffer

  device.present(); // Calling the HTML5 rendering loop recursively

  requestAnimationFrame(drawingLoop);
}

},{"./main":2}],2:[function(require,module,exports){
"use strict"; /// <reference path="babylon.math.ts"/>

Object.defineProperty(exports, "__esModule", {
  value: true
});
var SoftEngine;

(function (SoftEngine) {
  var Camera =
  /** @class */
  function () {
    function Camera() {
      this.position = BABYLON.Vector3.Zero();
      this.target = BABYLON.Vector3.Zero();
    }

    return Camera;
  }();

  SoftEngine.Camera = Camera;

  var Mesh =
  /** @class */
  function () {
    function Mesh(name, verticesCount, facesCount) {
      this.name = name;
      this.vertices = new Array(verticesCount);
      this.faces = new Array(facesCount);
      this.rotation = BABYLON.Vector3.Zero();
      this.postion = BABYLON.Vector3.Zero();
    }

    return Mesh;
  }();

  SoftEngine.Mesh = Mesh;

  var Device =
  /** @class */
  function () {
    function Device(canvas) {
      this.workingCanvas = canvas;
      this.workingWidth = canvas.width;
      this.workingHeight = canvas.height;
      this.workingContext = this.workingCanvas.getContext("2d");
    }

    Device.prototype.clear = function () {
      this.workingContext.clearRect(0, 0, this.workingWidth, this.workingHeight);
      this.backbuffer = this.workingContext.getImageData(0, 0, this.workingWidth, this.workingHeight);
    };

    Device.prototype.present = function () {
      this.workingContext.putImageData(this.backbuffer, 0, 0);
    };

    Device.prototype.putPixel = function (x, y, color) {
      this.backbufferdata = this.backbuffer.data;
      var index = ((x >> 0) + (y >> 0) * this.workingWidth) * 4;
      this.backbufferdata[index] = color.r * 255;
      this.backbufferdata[index + 1] = color.g * 255;
      this.backbufferdata[index + 2] = color.b * 255;
      this.backbufferdata[index + 3] = color.a * 255;
    };

    Device.prototype.project = function (coord, transMat) {
      var point = BABYLON.Vector3.TransformCoordinates(coord, transMat);
      var x = point.x * this.workingWidth + this.workingWidth / 2.0 >> 0;
      var y = -point.y * this.workingHeight + this.workingHeight / 2.0 >> 0;
      return new BABYLON.Vector2(x, y);
    };

    Device.prototype.drawPoint = function (point) {
      if (point.x >= 0 && point.y >= 0 && point.x < this.workingWidth && point.y < this.workingHeight) {
        this.putPixel(point.x, point.y, new BABYLON.Color4(1, 1, 0, 1));
      }
    };
    /** 绘制线条 是一个 递归绘制起始点 - 中间点 - 结束点（总共 3 pixel）的过程 */


    Device.prototype.drawLine = function (point0, point1) {
      var dist = point1.subtract(point0).length();

      if (dist < 2) {
        return;
      }

      var middlePoint = point0.add(point1.subtract(point0).scale(0.5));
      this.drawPoint(middlePoint);
      this.drawLine(point0, middlePoint);
      this.drawLine(middlePoint, point1);
    };

    Device.prototype.drawBline = function (point0, point1) {
      var x0 = point0.x >> 0;
      var y0 = point0.y >> 0;
      var x1 = point1.x >> 0;
      var y1 = point1.y >> 0;
      var dx = Math.abs(x1 - x0);
      var dy = Math.abs(y1 - y0);
      var sx = x0 < x1 ? 1 : -1;
      var sy = y0 < y1 ? 1 : -1;
      var err = dx - dy;

      while (true) {
        this.drawPoint(new BABYLON.Vector2(x0, y0));

        if (x0 == x1 && y0 == y1) {
          break;
        }

        var e2 = 2 * err;

        if (e2 > -dy) {
          err -= dy;
          x0 += sx;
        }

        if (e2 < dx) {
          err += dx;
          y0 += sy;
        }
      }
    };

    Device.prototype.render = function (camera, meshes) {
      var viewMatrix = BABYLON.Matrix.LookAtLH(camera.position, camera.target, BABYLON.Vector3.Up());
      var projectMatrix = BABYLON.Matrix.PerspectiveFovLH(0.78, this.workingWidth / this.workingHeight, 0.01, 1.0);

      for (var _i = 0, meshes_1 = meshes; _i < meshes_1.length; _i++) {
        var cMesh = meshes_1[_i];
        var worldMatrix = BABYLON.Matrix.RotationYawPitchRoll(cMesh.rotation.y, cMesh.rotation.x, cMesh.rotation.z).multiply(BABYLON.Matrix.Translation(cMesh.postion.x, cMesh.postion.y, cMesh.postion.z));
        var transformMatrix = worldMatrix.multiply(viewMatrix).multiply(projectMatrix);
        /** draw points */

        for (var _a = 0, _b = cMesh.vertices; _a < _b.length; _a++) {
          var indexVertex = _b[_a];
          var projectPoint = this.project(indexVertex, transformMatrix);
          this.drawPoint(projectPoint);
        }
        /** draw lines */
        // for (let i = 0; i < cMesh.vertices.length - 1; i++) {
        //     const point0 = this.project(cMesh.vertices[i], transformMatrix);
        //     const point1 = this.project(cMesh.vertices[i + 1], transformMatrix);
        //     this.drawLine(point0, point1);
        // }

        /** draw faces */


        for (var i = 0; i < cMesh.faces.length; i++) {
          var currentFace = cMesh.faces[i];
          var vertexA = cMesh.vertices[currentFace.A];
          var vertexB = cMesh.vertices[currentFace.B];
          var vertexC = cMesh.vertices[currentFace.C];
          var pixelA = this.project(vertexA, transformMatrix);
          var pixelB = this.project(vertexB, transformMatrix);
          var pixelC = this.project(vertexC, transformMatrix);
          this.drawLine(pixelA, pixelB);
          this.drawLine(pixelB, pixelC);
          this.drawLine(pixelC, pixelA); // this.drawBline(pixelA, pixelB);
          // this.drawBline(pixelB, pixelC);
          // this.drawBline(pixelC, pixelA);
        }
      }
    };

    return Device;
  }();

  SoftEngine.Device = Device;
})(SoftEngine = exports.SoftEngine || (exports.SoftEngine = {}));

},{}]},{},[1])
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYXBwLnRzIiwic3JjL21haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0lDQUE7O0FBQ0EsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQTs7QUFFQSxJQUFJLE1BQUo7QUFDQSxJQUFJLE1BQUo7QUFDQSxJQUFJLElBQUo7QUFDQSxJQUFNLE1BQU0sR0FBc0IsRUFBbEM7QUFDQSxJQUFJLE1BQUo7QUFFQSxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsa0JBQTFCLEVBQThDLElBQTlDLEVBQW9ELEtBQXBEOztBQUVBLFNBQVMsSUFBVCxHQUFhO0FBQ1QsRUFBQSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsYUFBeEIsQ0FBVCxDQURTLENBRVQ7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUEsRUFBQSxJQUFJLEdBQUcsSUFBSSxNQUFBLENBQUEsVUFBQSxDQUFXLElBQWYsQ0FBb0IsTUFBcEIsRUFBNEIsQ0FBNUIsRUFBK0IsRUFBL0IsQ0FBUDtBQUNBLEVBQUEsTUFBTSxDQUFDLElBQVAsQ0FBWSxJQUFaO0FBQ0EsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFDLENBQXJCLEVBQXdCLENBQXhCLEVBQTJCLENBQTNCLENBQW5CO0FBQ0EsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFwQixFQUF1QixDQUF2QixFQUEwQixDQUExQixDQUFuQjtBQUNBLEVBQUEsSUFBSSxDQUFDLFFBQUwsQ0FBYyxDQUFkLElBQW1CLElBQUksT0FBTyxDQUFDLE9BQVosQ0FBb0IsQ0FBQyxDQUFyQixFQUF3QixDQUFDLENBQXpCLEVBQTRCLENBQTVCLENBQW5CO0FBQ0EsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFwQixFQUF1QixDQUFDLENBQXhCLEVBQTJCLENBQTNCLENBQW5CO0FBQ0EsRUFBQSxJQUFJLENBQUMsUUFBTCxDQUFjLENBQWQsSUFBbUIsSUFBSSxPQUFPLENBQUMsT0FBWixDQUFvQixDQUFDLENBQXJCLEVBQXdCLENBQXhCLEVBQTJCLENBQUMsQ0FBNUIsQ0FBbkI7QUFDQSxFQUFBLElBQUksQ0FBQyxRQUFMLENBQWMsQ0FBZCxJQUFtQixJQUFJLE9BQU8sQ0FBQyxPQUFaLENBQW9CLENBQXBCLEVBQXVCLENBQXZCLEVBQTBCLENBQUMsQ0FBM0IsQ0FBbkI7QUFDQSxFQUFBLElBQUksQ0FBQyxRQUFMLENBQWMsQ0FBZCxJQUFtQixJQUFJLE9BQU8sQ0FBQyxPQUFaLENBQW9CLENBQXBCLEVBQXVCLENBQUMsQ0FBeEIsRUFBMkIsQ0FBQyxDQUE1QixDQUFuQjtBQUNBLEVBQUEsSUFBSSxDQUFDLFFBQUwsQ0FBYyxDQUFkLElBQW1CLElBQUksT0FBTyxDQUFDLE9BQVosQ0FBb0IsQ0FBQyxDQUFyQixFQUF3QixDQUFDLENBQXpCLEVBQTRCLENBQUMsQ0FBN0IsQ0FBbkI7QUFFQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFFQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUksQ0FBQyxLQUFMLENBQVcsQ0FBWCxJQUFnQjtBQUFFLElBQUEsQ0FBQyxFQUFFLENBQUw7QUFBUSxJQUFBLENBQUMsRUFBRSxDQUFYO0FBQWMsSUFBQSxDQUFDLEVBQUU7QUFBakIsR0FBaEI7QUFDQSxFQUFBLElBQUks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QXNCLGVBQXRCLENBQWY7QUFDQSxjQUFNLE1BQU0sR0FBRyxLQUFLLE9BQUwsQ0FBYSxPQUFiLEVBQXNCLGVBQXRCLENBQWY7QUFFQSxlQUFLLFFBQUwsQ0FBYyxNQUFkLEVBQXNCLE1BQXRCO0FBQ0EsZUFBSyxRQUFMLENBQWMsTUFBZCxFQUFzQixNQUF0QjtBQUNBLGVBQUssUUFBTCxDQUFjLE1BQWQsRUFBc0IsTUFBdEIsRUFieUMsQ0FjekM7QUFDQTtBQUNBO0FBQ0g7QUFDSjtBQUNKLEtBcERNOztBQXFEWCxXQUFBLE1BQUE7QUFBQyxHQXZKRCxFQUFBOztBQUFhLEVBQUEsVUFBQSxDQUFBLE1BQUEsR0FBTSxNQUFOO0FBd0poQixDQXZMRCxFQUFpQixVQUFVLEdBQVYsT0FBQSxDQUFBLFVBQUEsS0FBQSxPQUFBLENBQUEsVUFBQSxHQUFVLEVBQVYsQ0FBakIiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe2Z1bmN0aW9uIHIoZSxuLHQpe2Z1bmN0aW9uIG8oaSxmKXtpZighbltpXSl7aWYoIWVbaV0pe3ZhciBjPVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmU7aWYoIWYmJmMpcmV0dXJuIGMoaSwhMCk7aWYodSlyZXR1cm4gdShpLCEwKTt2YXIgYT1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK2krXCInXCIpO3Rocm93IGEuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixhfXZhciBwPW5baV09e2V4cG9ydHM6e319O2VbaV1bMF0uY2FsbChwLmV4cG9ydHMsZnVuY3Rpb24ocil7dmFyIG49ZVtpXVsxXVtyXTtyZXR1cm4gbyhufHxyKX0scCxwLmV4cG9ydHMscixlLG4sdCl9cmV0dXJuIG5baV0uZXhwb3J0c31mb3IodmFyIHU9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxpPTA7aTx0Lmxlbmd0aDtpKyspbyh0W2ldKTtyZXR1cm4gb31yZXR1cm4gcn0pKCkiLCIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiYmFieWxvbi5tYXRoLnRzXCIvPlxuaW1wb3J0IHsgU29mdEVuZ2luZSB9IGZyb20gXCIuL21haW5cIjtcblxubGV0IGNhbnZhczogSFRNTENhbnZhc0VsZW1lbnQ7XG5sZXQgZGV2aWNlOiBTb2Z0RW5naW5lLkRldmljZTtcbmxldCBtZXNoOiBTb2Z0RW5naW5lLk1lc2g7XG5jb25zdCBtZXNoZXM6IFNvZnRFbmdpbmUuTWVzaFtdID0gW107XG5sZXQgY2FtZXJhOiBTb2Z0RW5naW5lLkNhbWVyYTtcblxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcIkRPTUNvbnRlbnRMb2FkZWRcIiwgaW5pdCwgZmFsc2UpO1xuXG5mdW5jdGlvbiBpbml0KCkge1xuICAgIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZnJvbnRCdWZmZXJcIikgYXMgSFRNTENhbnZhc0VsZW1lbnQ7XG4gICAgLy8gbWVzaCA9IG5ldyBTb2Z0RW5naW5lLk1lc2goXCJDdWJlXCIsIDgpO1xuXG4gICAgLy8gbWVzaGVzLnB1c2gobWVzaCk7XG5cbiAgICAvLyBtZXNoLnZlcnRpY2VzWzBdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgMSwgMSk7XG4gICAgLy8gbWVzaC52ZXJ0aWNlc1sxXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgMSwgMSk7XG4gICAgLy8gbWVzaC52ZXJ0aWNlc1syXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTEsIC0xLCAxKTtcbiAgICAvLyBtZXNoLnZlcnRpY2VzWzNdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgLTEsIC0xKTtcbiAgICAvLyBtZXNoLnZlcnRpY2VzWzRdID0gbmV3IEJBQllMT04uVmVjdG9yMygtMSwgMSwgLTEpO1xuICAgIC8vIG1lc2gudmVydGljZXNbNV0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDEsIDEsIC0xKTtcbiAgICAvLyBtZXNoLnZlcnRpY2VzWzZdID0gbmV3IEJBQllMT04uVmVjdG9yMygxLCAtMSwgMSk7XG4gICAgLy8gbWVzaC52ZXJ0aWNlc1s3XSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgLTEsIC0xKTtcblxuICAgIG1lc2ggPSBuZXcgU29mdEVuZ2luZS5NZXNoKFwiQ3ViZVwiLCA4LCAxMik7XG4gICAgbWVzaGVzLnB1c2gobWVzaCk7XG4gICAgbWVzaC52ZXJ0aWNlc1swXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTEsIDEsIDEpO1xuICAgIG1lc2gudmVydGljZXNbMV0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDEsIDEsIDEpO1xuICAgIG1lc2gudmVydGljZXNbMl0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC0xLCAtMSwgMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1szXSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgLTEsIDEpO1xuICAgIG1lc2gudmVydGljZXNbNF0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKC0xLCAxLCAtMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1s1XSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMSwgMSwgLTEpO1xuICAgIG1lc2gudmVydGljZXNbNl0gPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDEsIC0xLCAtMSk7XG4gICAgbWVzaC52ZXJ0aWNlc1s3XSA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoLTEsIC0xLCAtMSk7XG5cbiAgICBtZXNoLmZhY2VzWzBdID0geyBBOiAwLCBCOiAxLCBDOiAyIH07XG4gICAgbWVzaC5mYWNlc1sxXSA9IHsgQTogMSwgQjogMiwgQzogMyB9O1xuICAgIG1lc2guZmFjZXNbMl0gPSB7IEE6IDEsIEI6IDMsIEM6IDYgfTtcbiAgICBtZXNoLmZhY2VzWzNdID0geyBBOiAxLCBCOiA1LCBDOiA2IH07XG4gICAgbWVzaC5mYWNlc1s0XSA9IHsgQTogMCwgQjogMSwgQzogNCB9O1xuICAgIG1lc2guZmFjZXNbNV0gPSB7IEE6IDEsIEI6IDQsIEM6IDUgfTtcblxuICAgIG1lc2guZmFjZXNbNl0gPSB7IEE6IDIsIEI6IDMsIEM6IDcgfTtcbiAgICBtZXNoLmZhY2VzWzddID0geyBBOiAzLCBCOiA2LCBDOiA3IH07XG4gICAgbWVzaC5mYWNlc1s4XSA9IHsgQTogMCwgQjogMiwgQzogNyB9O1xuICAgIG1lc2guZmFjZXNbOV0gPSB7IEE6IDAsIEI6IDQsIEM6IDcgfTtcbiAgICBtZXNoLmZhY2VzWzEwXSA9IHsgQTogNCwgQjogNSwgQzogNiB9O1xuICAgIG1lc2guZmFjZXNbMTFdID0geyBBOiA0LCBCOiA2LCBDOiA3IH07XG5cbiAgICBjYW1lcmEgPSBuZXcgU29mdEVuZ2luZS5DYW1lcmEoKTtcbiAgICBkZXZpY2UgPSBuZXcgU29mdEVuZ2luZS5EZXZpY2UoY2FudmFzKTtcblxuICAgIGNhbWVyYS5wb3NpdGlvbiA9IG5ldyBCQUJZTE9OLlZlY3RvcjMoMCwgMCwgMTApO1xuICAgIGNhbWVyYS50YXJnZXQgPSBuZXcgQkFCWUxPTi5WZWN0b3IzKDAsIDAsIDApO1xuXG4gICAgLy8gQ2FsbGluZyB0aGUgSFRNTDUgcmVuZGVyaW5nIGxvb3BcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd2luZ0xvb3ApO1xufVxuXG5mdW5jdGlvbiBkcmF3aW5nTG9vcCgpIHtcbiAgICBkZXZpY2UuY2xlYXIoKTtcblxuICAgIC8vIHJvdGF0aW5nIHNsaWdodGx5IHRoZSBjdWJlIGR1cmluZyBlYWNoIGZyYW1lIHJlbmRlcmVkXG4gICAgbWVzaC5yb3RhdGlvbi54ICs9IDAuMDE7XG4gICAgbWVzaC5yb3RhdGlvbi55ICs9IDAuMDE7XG5cbiAgICAvLyBEb2luZyB0aGUgdmFyaW91cyBtYXRyaXggb3BlcmF0aW9uc1xuICAgIGRldmljZS5yZW5kZXIoY2FtZXJhLCBtZXNoZXMpO1xuICAgIC8vIEZsdXNoaW5nIHRoZSBiYWNrIGJ1ZmZlciBpbnRvIHRoZSBmcm9udCBidWZmZXJcbiAgICBkZXZpY2UucHJlc2VudCgpO1xuXG4gICAgLy8gQ2FsbGluZyB0aGUgSFRNTDUgcmVuZGVyaW5nIGxvb3AgcmVjdXJzaXZlbHlcbiAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZHJhd2luZ0xvb3ApO1xufVxuIiwiLy8vIDxyZWZlcmVuY2UgcGF0aD1cImJhYnlsb24ubWF0aC50c1wiLz5cblxuZXhwb3J0IG5hbWVzcGFjZSBTb2Z0RW5naW5lIHtcbiAgICBleHBvcnQgY2xhc3MgQ2FtZXJhIHtcbiAgICAgICAgcHVibGljIHBvc2l0aW9uOiBCQUJZTE9OLlZlY3RvcjM7XG4gICAgICAgIHB1YmxpYyB0YXJnZXQ6IEJBQllMT04uVmVjdG9yMztcblxuICAgICAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgICAgIHRoaXMucG9zaXRpb24gPSBCQUJZTE9OLlZlY3RvcjMuWmVybygpO1xuICAgICAgICAgICAgdGhpcy50YXJnZXQgPSBCQUJZTE9OLlZlY3RvcjMuWmVybygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZXhwb3J0IGludGVyZmFjZSBGYWNlIHtcbiAgICAgICAgQTogbnVtYmVyO1xuICAgICAgICBCOiBudW1iZXI7XG4gICAgICAgIEM6IG51bWJlcjtcbiAgICB9XG5cbiAgICBleHBvcnQgY2xhc3MgTWVzaCB7XG4gICAgICAgIHB1YmxpYyBwb3N0aW9uOiBCQUJZTE9OLlZlY3RvcjM7XG4gICAgICAgIHB1YmxpYyByb3RhdGlvbjogQkFCWUxPTi5WZWN0b3IzO1xuICAgICAgICBwdWJsaWMgdmVydGljZXM6IEJBQllMT04uVmVjdG9yM1tdO1xuICAgICAgICBwdWJsaWMgZmFjZXM6IEZhY2VbXTtcblxuICAgICAgICBjb25zdHJ1Y3RvcihwdWJsaWMgbmFtZTogc3RyaW5nLCB2ZXJ0aWNlc0NvdW50OiBudW1iZXIsIGZhY2VzQ291bnQ6IG51bWJlcikge1xuICAgICAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBBcnJheSh2ZXJ0aWNlc0NvdW50KTtcbiAgICAgICAgICAgIHRoaXMuZmFjZXMgPSBuZXcgQXJyYXkoZmFjZXNDb3VudCk7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0gQkFCWUxPTi5WZWN0b3IzLlplcm8oKTtcbiAgICAgICAgICAgIHRoaXMucG9zdGlvbiA9IEJBQllMT04uVmVjdG9yMy5aZXJvKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBleHBvcnQgY2xhc3MgRGV2aWNlIHtcbiAgICAgICAgcHJpdmF0ZSBiYWNrYnVmZmVyPzogSW1hZ2VEYXRhO1xuICAgICAgICBwcml2YXRlIHdvcmtpbmdDYW52YXM6IEhUTUxDYW52YXNFbGVtZW50O1xuICAgICAgICBwcml2YXRlIHdvcmtpbmdDb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XG4gICAgICAgIHByaXZhdGUgd29ya2luZ1dpZHRoOiBudW1iZXI7XG4gICAgICAgIHByaXZhdGUgd29ya2luZ0hlaWdodDogbnVtYmVyO1xuXG4gICAgICAgIHByaXZhdGUgYmFja2J1ZmZlcmRhdGE/OiBVaW50OENsYW1wZWRBcnJheTtcblxuICAgICAgICBjb25zdHJ1Y3RvcihjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLndvcmtpbmdDYW52YXMgPSBjYW52YXM7XG4gICAgICAgICAgICB0aGlzLndvcmtpbmdXaWR0aCA9IGNhbnZhcy53aWR0aDtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0hlaWdodCA9IGNhbnZhcy5oZWlnaHQ7XG5cbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQgPSB0aGlzLndvcmtpbmdDYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpITtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBjbGVhcigpOiB2b2lkIHtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQuY2xlYXJSZWN0KDAsIDAsIHRoaXMud29ya2luZ1dpZHRoLCB0aGlzLndvcmtpbmdIZWlnaHQpO1xuICAgICAgICAgICAgdGhpcy5iYWNrYnVmZmVyID0gdGhpcy53b3JraW5nQ29udGV4dC5nZXRJbWFnZURhdGEoMCwgMCwgdGhpcy53b3JraW5nV2lkdGgsIHRoaXMud29ya2luZ0hlaWdodCk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgcHJlc2VudCgpIHtcbiAgICAgICAgICAgIHRoaXMud29ya2luZ0NvbnRleHQucHV0SW1hZ2VEYXRhKHRoaXMuYmFja2J1ZmZlciEsIDAsIDApO1xuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHB1dFBpeGVsKHg6IG51bWJlciwgeTogbnVtYmVyLCBjb2xvcjogQkFCWUxPTi5Db2xvcjQpIHtcbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGEgPSB0aGlzLmJhY2tidWZmZXIhLmRhdGE7XG5cbiAgICAgICAgICAgIGNvbnN0IGluZGV4OiBudW1iZXIgPSAoKHggPj4gMCkgKyAoeSA+PiAwKSAqIHRoaXMud29ya2luZ1dpZHRoKSAqIDQ7XG5cbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGFbaW5kZXhdID0gY29sb3IuciAqIDI1NTtcbiAgICAgICAgICAgIHRoaXMuYmFja2J1ZmZlcmRhdGFbaW5kZXggKyAxXSA9IGNvbG9yLmcgKiAyNTU7XG4gICAgICAgICAgICB0aGlzLmJhY2tidWZmZXJkYXRhW2luZGV4ICsgMl0gPSBjb2xvci5iICogMjU1O1xuICAgICAgICAgICAgdGhpcy5iYWNrYnVmZmVyZGF0YVtpbmRleCArIDNdID0gY29sb3IuYSAqIDI1NTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBwcm9qZWN0KGNvb3JkOiBCQUJZTE9OLlZlY3RvcjMsIHRyYW5zTWF0OiBCQUJZTE9OLk1hdHJpeCk6IEJBQllMT04uVmVjdG9yMiB7XG4gICAgICAgICAgICBjb25zdCBwb2ludCA9IEJBQllMT04uVmVjdG9yMy5UcmFuc2Zvcm1Db29yZGluYXRlcyhjb29yZCwgdHJhbnNNYXQpO1xuXG4gICAgICAgICAgICBjb25zdCB4ID0gKHBvaW50LnggKiB0aGlzLndvcmtpbmdXaWR0aCArIHRoaXMud29ya2luZ1dpZHRoIC8gMi4wKSA+PiAwO1xuICAgICAgICAgICAgY29uc3QgeSA9ICgtcG9pbnQueSAqIHRoaXMud29ya2luZ0hlaWdodCArIHRoaXMud29ya2luZ0hlaWdodCAvIDIuMCkgPj4gMDtcblxuICAgICAgICAgICAgcmV0dXJuIG5ldyBCQUJZTE9OLlZlY3RvcjIoeCwgeSk7XG4gICAgICAgIH1cblxuICAgICAgICBwdWJsaWMgZHJhd1BvaW50KHBvaW50OiBCQUJZTE9OLlZlY3RvcjIpIHtcbiAgICAgICAgICAgIGlmIChwb2ludC54ID49IDAgJiYgcG9pbnQueSA+PSAwICYmIHBvaW50LnggPCB0aGlzLndvcmtpbmdXaWR0aCAmJiBwb2ludC55IDwgdGhpcy53b3JraW5nSGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wdXRQaXhlbChwb2ludC54LCBwb2ludC55LCBuZXcgQkFCWUxPTi5Db2xvcjQoMSwgMSwgMCwgMSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLyoqIOe7mOWItue6v+adoSDmmK/kuIDkuKog6YCS5b2S57uY5Yi26LW35aeL54K5IC0g5Lit6Ze054K5IC0g57uT5p2f54K577yI5oC75YWxIDMgcGl4ZWzvvInnmoTov4fnqIsgKi9cbiAgICAgICAgcHVibGljIGRyYXdMaW5lKHBvaW50MDogQkFCWUxPTi5WZWN0b3IyLCBwb2ludDE6IEJBQllMT04uVmVjdG9yMik6IHZvaWQge1xuICAgICAgICAgICAgY29uc3QgZGlzdCA9IHBvaW50MS5zdWJ0cmFjdChwb2ludDApLmxlbmd0aCgpO1xuXG4gICAgICAgICAgICBpZiAoZGlzdCA8IDIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IG1pZGRsZVBvaW50ID0gcG9pbnQwLmFkZChwb2ludDEuc3VidHJhY3QocG9pbnQwKS5zY2FsZSgwLjUpKTtcblxuICAgICAgICAgICAgdGhpcy5kcmF3UG9pbnQobWlkZGxlUG9pbnQpO1xuXG4gICAgICAgICAgICB0aGlzLmRyYXdMaW5lKHBvaW50MCwgbWlkZGxlUG9pbnQpO1xuICAgICAgICAgICAgdGhpcy5kcmF3TGluZShtaWRkbGVQb2ludCwgcG9pbnQxKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHB1YmxpYyBkcmF3QmxpbmUocG9pbnQwOiBCQUJZTE9OLlZlY3RvcjIsIHBvaW50MTogQkFCWUxPTi5WZWN0b3IyKTogdm9pZCB7XG4gICAgICAgICAgICBsZXQgeDAgPSBwb2ludDAueCA+PiAwO1xuICAgICAgICAgICAgbGV0IHkwID0gcG9pbnQwLnkgPj4gMDtcbiAgICAgICAgICAgIGNvbnN0IHgxID0gcG9pbnQxLnggPj4gMDtcbiAgICAgICAgICAgIGNvbnN0IHkxID0gcG9pbnQxLnkgPj4gMDtcbiAgICAgICAgICAgIGNvbnN0IGR4ID0gTWF0aC5hYnMoeDEgLSB4MCk7XG4gICAgICAgICAgICBjb25zdCBkeSA9IE1hdGguYWJzKHkxIC0geTApO1xuXG4gICAgICAgICAgICBjb25zdCBzeCA9IHgwIDwgeDEgPyAxIDogLTE7XG4gICAgICAgICAgICBjb25zdCBzeSA9IHkwIDwgeTEgPyAxIDogLTE7XG5cbiAgICAgICAgICAgIGxldCBlcnIgPSBkeCAtIGR5O1xuXG4gICAgICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhd1BvaW50KG5ldyBCQUJZTE9OLlZlY3RvcjIoeDAsIHkwKSk7XG4gICAgICAgICAgICAgICAgaWYgKHgwID09IHgxICYmIHkwID09IHkxKSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCBlMiA9IDIgKiBlcnI7XG4gICAgICAgICAgICAgICAgaWYgKGUyID4gLWR5KSB7XG4gICAgICAgICAgICAgICAgICAgIGVyciAtPSBkeTtcbiAgICAgICAgICAgICAgICAgICAgeDAgKz0gc3g7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChlMiA8IGR4KSB7XG4gICAgICAgICAgICAgICAgICAgIGVyciArPSBkeDtcbiAgICAgICAgICAgICAgICAgICAgeTAgKz0gc3k7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcHVibGljIHJlbmRlcihjYW1lcmE6IENhbWVyYSwgbWVzaGVzOiBNZXNoW10pIHtcbiAgICAgICAgICAgIGNvbnN0IHZpZXdNYXRyaXggPSBCQUJZTE9OLk1hdHJpeC5Mb29rQXRMSChjYW1lcmEucG9zaXRpb24sIGNhbWVyYS50YXJnZXQsIEJBQllMT04uVmVjdG9yMy5VcCgpKTtcblxuICAgICAgICAgICAgY29uc3QgcHJvamVjdE1hdHJpeCA9IEJBQllMT04uTWF0cml4LlBlcnNwZWN0aXZlRm92TEgoXG4gICAgICAgICAgICAgICAgMC43OCxcbiAgICAgICAgICAgICAgICB0aGlzLndvcmtpbmdXaWR0aCAvIHRoaXMud29ya2luZ0hlaWdodCxcbiAgICAgICAgICAgICAgICAwLjAxLFxuICAgICAgICAgICAgICAgIDEuMCxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGZvciAoY29uc3QgY01lc2ggb2YgbWVzaGVzKSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgd29ybGRNYXRyaXggPSBCQUJZTE9OLk1hdHJpeC5Sb3RhdGlvbllhd1BpdGNoUm9sbChcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueSxcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueCxcbiAgICAgICAgICAgICAgICAgICAgY01lc2gucm90YXRpb24ueixcbiAgICAgICAgICAgICAgICApLm11bHRpcGx5KEJBQllMT04uTWF0cml4LlRyYW5zbGF0aW9uKGNNZXNoLnBvc3Rpb24ueCwgY01lc2gucG9zdGlvbi55LCBjTWVzaC5wb3N0aW9uLnopKTtcblxuICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zZm9ybU1hdHJpeCA9IHdvcmxkTWF0cml4Lm11bHRpcGx5KHZpZXdNYXRyaXgpLm11bHRpcGx5KHByb2plY3RNYXRyaXgpO1xuXG4gICAgICAgICAgICAgICAgLyoqIGRyYXcgcG9pbnRzICovXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBpbmRleFZlcnRleCBvZiBjTWVzaC52ZXJ0aWNlcykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwcm9qZWN0UG9pbnQgPSB0aGlzLnByb2plY3QoaW5kZXhWZXJ0ZXgsIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd1BvaW50KHByb2plY3RQb2ludCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgLyoqIGRyYXcgbGluZXMgKi9cbiAgICAgICAgICAgICAgICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IGNNZXNoLnZlcnRpY2VzLmxlbmd0aCAtIDE7IGkrKykge1xuICAgICAgICAgICAgICAgIC8vICAgICBjb25zdCBwb2ludDAgPSB0aGlzLnByb2plY3QoY01lc2gudmVydGljZXNbaV0sIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICAgICAgICAgICAgLy8gICAgIGNvbnN0IHBvaW50MSA9IHRoaXMucHJvamVjdChjTWVzaC52ZXJ0aWNlc1tpICsgMV0sIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICAgICAgICAgICAgLy8gICAgIHRoaXMuZHJhd0xpbmUocG9pbnQwLCBwb2ludDEpO1xuICAgICAgICAgICAgICAgIC8vIH1cblxuICAgICAgICAgICAgICAgIC8qKiBkcmF3IGZhY2VzICovXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjTWVzaC5mYWNlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50RmFjZSA9IGNNZXNoLmZhY2VzW2ldO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZlcnRleEEgPSBjTWVzaC52ZXJ0aWNlc1tjdXJyZW50RmFjZS5BXTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdmVydGV4QiA9IGNNZXNoLnZlcnRpY2VzW2N1cnJlbnRGYWNlLkJdO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2ZXJ0ZXhDID0gY01lc2gudmVydGljZXNbY3VycmVudEZhY2UuQ107XG5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGl4ZWxBID0gdGhpcy5wcm9qZWN0KHZlcnRleEEsIHRyYW5zZm9ybU1hdHJpeCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBpeGVsQiA9IHRoaXMucHJvamVjdCh2ZXJ0ZXhCLCB0cmFuc2Zvcm1NYXRyaXgpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwaXhlbEMgPSB0aGlzLnByb2plY3QodmVydGV4QywgdHJhbnNmb3JtTWF0cml4KTtcblxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRyYXdMaW5lKHBpeGVsQSwgcGl4ZWxCKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kcmF3TGluZShwaXhlbEIsIHBpeGVsQyk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZHJhd0xpbmUocGl4ZWxDLCBwaXhlbEEpO1xuICAgICAgICAgICAgICAgICAgICAvLyB0aGlzLmRyYXdCbGluZShwaXhlbEEsIHBpeGVsQik7XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoaXMuZHJhd0JsaW5lKHBpeGVsQiwgcGl4ZWxDKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5kcmF3QmxpbmUocGl4ZWxDLCBwaXhlbEEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cbiJdfQ==
